(function(h){Array.prototype.shuffle=function(){for(var d,a,o=this.length;o;d=parseInt(Math.random()*o),a=this[--o],this[o]=this[d],this[d]=a);return this};h.wordCloudSupported=function(){var d=h("<canvas />");if(!d[0]||!d[0].getContext)return false;d=d[0].getContext("2d");if(!d.getImageData)return false;if(!d.fillText)return false;if(!Array.prototype.some)return false;if(!Array.prototype.push)return false;return true}();h.fn.wordCloud=function(d){if(!h.wordCloudSupported)return this;var a={fontFamily:'"Trebuchet MS", "Heiti TC", "\u5fae\u8edf\u6b63\u9ed1\u9ad4", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',
gridSize:8,ellipticity:0.65,drawMask:false,maskColor:"rgba(255,0,0,0.3)",maskGridWidth:0.3,wordColor:"rgba(0,0,0,0.7)",backgroundColor:"rgba(255, 255, 255, 1)",wait:0,abortThreshold:0,abort:h.noop,weightFactor:1,wordList:[]};d&&h.extend(a,d);if(typeof a.weightFactor!=="function"){var o=a.weightFactor;a.weightFactor=function(f){return f*o}}a.gridSize=Math.max(a.gridSize,4);var b=a.gridSize,c,t,j,k,B,C,D,u,E=function(){return a.abortThreshold>0&&(new Date).getTime()-D>a.abortThreshold},G=function(f,
m){c.font=a.weightFactor(m).toString(10)+"px "+a.fontFamily;var e=c.measureText(f).width,x=Math.max(a.weightFactor(m),c.measureText("m").width,c.measureText("\uff37").width),p,q;if(/[gpqy]/.test(f))x*=1.5;p=Math.ceil(e/b);q=Math.ceil(x/b);var y=Math.floor(Math.sqrt(j*j+k*k)),z=j+k,v,w,A;for(v=y;v--;){w=z;for(A=[];w--;)A.push([Math.floor(j/2+(y-v)*Math.cos(w/z*2*Math.PI)-p/2),Math.floor(k/2+(y-v)*a.ellipticity*Math.sin(w/z*2*Math.PI)-q/2)]);if(A.shuffle().some(function(i){var g;a:{g=i[0];var r=i[1];
if(g<0||r<0||g+p>j||r+q>k)g=false;else{for(var n=p,l;n--;)for(l=q;l--;)if(!t[g+n][r+l]){g=false;break a}g=true}}if(g){c.fillStyle=a.wordColor;c.fillText(f,i[0]*b+(p*b-e)/2,i[1]*b+ +(q*b-x)/2);g=i[0];i=i[1];r=a.drawMask;n=p;if(r)c.fillStyle=a.maskColor;a:for(;n--;)for(l=q;l--;){var s;b:{s=b*b*4;for(var F=c.getImageData((g+n)*b,(i+l)*b,b,b);s-=4;)if(F.data[s+B]!==C){s=false;break b}s=true}if(!s){t[g+n][i+l]=false;r&&c.fillRect((g+n)*b,(i+l)*b,b-a.maskGridWidth,b-a.maskGridWidth)}if(E())break a}return true}return false}))return true}return false};
return this.each(function(){if(this.nodeName.toLowerCase()==="canvas"){j=Math.floor(h(this).attr("width")/b);k=Math.floor(h(this).attr("height")/b);c=this.getContext("2d");t=[];c.fillStyle=a.backgroundColor;c.clearRect(0,0,1,1);c.fillStyle=a.backgroundColor;c.fillRect(0,0,1,1);var f=c.getImageData(0,0,1,1).data;c.fillStyle=a.wordColor;c.fillRect(0,0,1,1);for(var m=c.getImageData(0,0,1,1).data,e=4;e--;)if(Math.abs(m[e]-f[e])>10){B=e;C=f[e];break}c.fillStyle=a.backgroundColor;c.clearRect(0,0,j*(b+1),
k*(b+1));c.fillRect(0,0,j*(b+1),k*(b+1));for(f=j;f--;){t[f]=[];for(m=k;m--;)t[f][m]=true}c.textBaseline="top";clearTimeout(h(this).data("wordCloud-timer"));e=0;u=setInterval(function(){if(e>=a.wordList.length)clearTimeout(u);else{D=(new Date).getTime();G(a.wordList[e][0],a.wordList[e][1]);if(E()){clearTimeout(u);a.abort()}e++}},a.wait);h(this).data("wordCloud-timer",u)}})}})(jQuery);